<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>AD9361 high performance, highly integrated RF Agile Transceiver™ Linux device driver &#8212; Linux Kernel: Variant from Analog Devices, Inc. v6.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/style.min.css?v=cf8483f0" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <script src="../../../_static/documentation_options.js?v=cb43cce9"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/tabs.js?v=3ee01567"></script>
    <script defer="" src="../../../_static/app.umd.js?v=96350458"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="AD9371, AD9375 highly integrated, wideband RF transceiver Linux device driver" href="ad9371.html" />
    <link rel="prev" title="AXI ADC HDL Linux Driver" href="../iio-adc/axi-adc-hdl.html" />
   
  
    <meta name="robots" content="noindex">
  
  


<style>
  body {
    
  }

  body.dark {
    
  }

  @media (prefers-color-scheme: dark) {
    body:not(.light) {
      
    }
  }
</style>
  </head><body>
  <input type="checkbox" id="input-show-toc">
  <input type="checkbox" id="input-show-localtoc">
  <header>
    <div class="header">
      <div id="left">
        <label id="show-sidebar" for="input-show-toc" title="Show/hide index"></label>
      </div>
      <div id="right">
        <span>
          <a id="logo-org" href="https://analog.com"></a>
              <a id="no-logo" href="../../../index.html">
                Linux Kernel: Variant from Analog Devices, Inc.
              </a>
        </span>
        <span class="reverse">
          <label id="show-localtoc" for="input-show-localtoc" title="Show/hide contents"></label>
        </span>
      </div>
    </div>
    <div class="repotoc-tree">
      <root>
  <a href="../../../../documentation/eval/index.html">Evaluation Boards</a>
  <a href="../../../../documentation/university/index.html">University Program</a>
  <a href="../../../../hdl/index.html">HDL</a>
  <a href="../../../../no-OS/index.html">no-OS</a>
  <a href="../../../../pyadi-iio/index.html">pyadi-iio</a>
  <a href="../../../../precision-converters-firmware/index.html">Precision Converters Firmware</a>
  <a href="../../../../PrecisionToolbox/index.html">Precision Toolbox</a>
</root>

    </div>
  </header>

    <div class="localtoc">
      <div class="tocwrapper">
        <div>
          <div class="localtoc-header">On this page</div>
          <a id="scroll-up" href="#top-anchor" title="Back to top"></a>
        </div>
        <nav>
          <ul>
<li><a class="reference internal" href="#">AD9361 high performance, highly integrated RF Agile Transceiver™ Linux device driver</a><ul>
<li><a class="reference internal" href="#supported-devices">Supported Devices</a></li>
<li><a class="reference internal" href="#reference-circuits">Reference Circuits</a></li>
<li><a class="reference internal" href="#evaluation-boards">Evaluation Boards</a></li>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#source-code">Source Code</a><ul>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#files">Files</a><ul>
<li><a class="reference internal" href="#related-device-drivers">Related Device Drivers</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#device-driver-customization">Device Driver Customization</a></li>
<li><a class="reference internal" href="#example-linux-device-tree-initialization">Example Linux Device-Tree Initialization</a></li>
<li><a class="reference internal" href="#enabling-linux-driver-support">Enabling Linux driver support</a></li>
<li><a class="reference internal" href="#adding-linux-driver-support">Adding Linux driver support</a></li>
<li><a class="reference internal" href="#hardware-configuration">Hardware configuration</a></li>
<li><a class="reference internal" href="#driver-testing-api">Driver testing / API</a><ul>
<li><a class="reference internal" href="#general-attribute-naming-convention">General attribute naming convention:</a></li>
<li><a class="reference internal" href="#local-oscillator-control-lo">Local Oscillator Control (LO)</a><ul>
<li><a class="reference internal" href="#create-profile">Create Profile</a></li>
<li><a class="reference internal" href="#setting-querying-the-rx-sample-rate">Setting / Querying the RX Sample Rate</a></li>
<li><a class="reference internal" href="#setting-querying-the-tx-sample-rate">Setting / Querying the TX Sample Rate</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </nav>
      </div>
    </div>

  
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
              <a id="no-logo" href="../../../index.html">
                Linux Kernel: Variant from Analog Devices, Inc.
              </a><input id="input-switch-toc" type="checkbox">
<label id="show-repotoc" for="input-switch-toc">
All content
</label>
<label id="show-toc" for="input-switch-toc">
Content on this topic
</label>
<div class="repotoc-tree">
  <root>
  <a href="../../../../documentation/eval/index.html">Evaluation Boards</a>
  <a href="../../../../documentation/university/index.html">University Program</a>
  <a href="../../../../hdl/index.html">HDL</a>
  <a href="../../../../no-OS/index.html">no-OS</a>
  <a href="../../../../pyadi-iio/index.html">pyadi-iio</a>
  <a href="../../../../precision-converters-firmware/index.html">Precision Converters Firmware</a>
  <a href="../../../../PrecisionToolbox/index.html">Precision Toolbox</a>
</root>

</div>
<div class="toc-tree">
  <html>
  <body><ul class="current">
<li class="toctree-l1 current"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1" id="toctree-collapse-1" checked=""/><div class="collapse"><a class="reference internal" href="../../../drivers_index.html">Linux Drivers</a><label for="toctree-collapse-1"><div class="icon"></div></label></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../sound/ad1835a.html">AD1835A</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/ad1936.html">AD1933</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-resolver/ad2s1200.html">AD2S1200</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-resolver/ad2s1210.html">AD2S1210</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-resolver/ad2s90.html">AD2S90</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/axi-ad3552r.html">AD3552R</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad400x.html">AD4003</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad4630.html">AD4030-24</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5064.html">AD5024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/dpot.html">AD5160</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5446.html">AD5300</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5676.html">AD5310R</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5360.html">AD5360</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5380.html">AD5380</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regulator/ad5398.html">AD5398</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5449.html">AD5415</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5421.html">AD5421</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5504.html">AD5501</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5592r.html">AD5592R</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5593r.html">AD5593R</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5624r.html">AD5624</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5755.html">AD5735</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5764.html">AD5744</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5758.html">AD5758</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5791.html">AD5760</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ad5770r.html">AD5770R</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-impedance-analyzer/ad5933.html">AD5933</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad6676.html">AD6676</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad9208.html">AD6684</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7476a.html">AD7091</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7091r5.html">AD7091R-5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7091r8.html">AD7091R-8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7124.html">AD7124-4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input-misc/ad714x.html">AD7142</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-cdc/ad7150.html">AD7150</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-cdc/ad7152.html">AD7152</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7780.html">AD7170</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7192.html">AD7190</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7266.html">AD7265</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7280a.html">AD7280A</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7291.html">AD7291</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7298.html">AD7298</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/ad73322.html">AD73311</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad738x.html">AD7380</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-addac/ad74413r.html">AD74412R</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7606.html">AD7605-4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-cdc/ad7745.html">AD7745</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7766.html">AD7766-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7768-1.html">AD7768-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7768.html">AD7768</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7793.html">AD7785</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7791.html">AD7787</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input-touchscreen/ad7873.html">AD7843</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input-touchscreen/ad7877.html">AD7877</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input-touchscreen/ad7879.html">AD7879-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7887.html">AD7887</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad7998.html">AD7991</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-amplifiers/ad8366.html">AD8366</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-mxfe/ad9081.html">AD9081</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/ad9083.html">AD9083</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dds/axi-dac-dds-hdl.html">AD9122</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/ad9162.html">AD9161</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resources/tools-software/linux-drivers/iio-adc/ad9208.html">AD9208</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/axi-adc-hdl.html">AD9234</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">AD9361</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad9371.html">AD9371</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/ad9508.html">AD9508</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/ad9517.html">AD9516-0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/ad9523.html">AD9523-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/ad9528.html">AD9528</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clk/adi/clk-ad9545.c.html">AD9545</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dds/ad9832.html">AD9832</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dds/ad9834.html">AD9833</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-amplifiers/ada4250.html">ADA4250</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/adaq8092.html">ADAQ8092</a></li>
<li class="toctree-l2"><a class="reference internal" href="adar1000.html">ADAR1000</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-adc/adas1000.html">ADAS1000</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adau1361.html">ADAU1361</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adau1372.html">ADAU1372</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adau1373.html">ADAU1373</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adau1381.html">ADAU1381</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adau1701.html">ADAU1401</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adau1977.html">ADAU1977</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adau7002.html">ADAU7002</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adau7118.html">ADAU7118</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/adav801.html">ADAV801</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/adf4159.html">ADF4159</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/adf4350.html">ADF4350</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/adf5355.html">ADF4355-2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/adf4360.html">ADF4360-0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/adf4371.html">ADF4371</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/adf4377.html">ADF4377</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking-mac802154/adf7242.html">ADF7241</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mux/adgs1408.html">ADGS1408</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net-phy/adin1100.html">ADIN1100</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net-mac-phy/adin1110.html">ADIN1110</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net-phy/adin.html">ADIN1200</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net-mac-phy/adin2111.html">ADIN2111</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-gyroscope/adis16060.html">ADIS16060</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-gyroscope/adis16080.html">ADIS16080</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-gyroscope/adis16130.html">ADIS16130</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-gyroscope/adis16136.html">ADIS16133</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-accelerometer/adis16201.html">ADIS16201</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-accelerometer/adis16203.html">ADIS16203</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-accelerometer/adis16209.html">ADIS16209</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-accelerometer/adis16240.html">ADIS16240</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-gyroscope/adis16260.html">ADIS16250</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-inertial-measurement-units/adis16400.html">ADIS16300</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-inertial-measurement-units/adis16480.html">ADIS16375</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-inertial-measurement-units/adis16475.html">ADIS16460</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-vector-power/adl5960.html">ADL5960</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/admv1013.html">ADMV1013</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/admv1014.html">ADMV1014</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-filter/admv8818.html">ADMV8818</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regulator/adp150.html">ADP122</a></li>
<li class="toctree-l2"><a class="reference internal" href="../leds/adp1650.html">ADP1650</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multifunction-device/adp5520.html">ADP5501</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input-keyboard/adp5589.html">ADP5585</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input-keyboard/adp5588.html">ADP5587</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backlight/adp8860.html">ADP8860</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backlight/adp8870.html">ADP8870</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/adrf6780.html">ADRF6780</a></li>
<li class="toctree-l2"><a class="reference internal" href="adrv9002.html">ADRV9002</a></li>
<li class="toctree-l2"><a class="reference internal" href="adrv9009.html">ADRV9008-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../drm/adv7511.html">ADV7511</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-accelerometer/adxl313.html">ADXL312,</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input-misc/adxl345.html">ADXL345</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-accelerometer/adxl355.html">ADXL355</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input-misc/adxl362.html">ADXL362</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-accelerometer/adxl367.html">ADXL367</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-accelerometer/adxl372.html">ADXL372</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-gyroscope/adxrs450.html">ADXRS450</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hwmon/axi_fan_control.html">Fan Control IP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-amplifiers/hmc425a.html">HMC425</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/hmc7044.html">HMC7043</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-dac/ltc2664.html">LTC2664</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hwmon/ltc2947.html">LTC2947</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-temperature/ltc2983.html">LTC2983</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio-pll/ltc6952.html">LTC6952</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial/max310x.html">MAX14830</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net-mac-phy/open_alliance.html">Open Alliance - 10BASE-T1x MAC-PHY Serial Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/ssm2602.html">SSM2602</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/ssm4567.html">SSM4567</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build.html">Building Kernels</a></li>
</ul>
</body>
</html>

</div>
        </div>
      </div>

  <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper" id="top-anchor">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="ad9361-high-performance-highly-integrated-rf-agile-transceiver-linux-device-driver">
<h1>AD9361 high performance, highly integrated RF Agile Transceiver™ Linux device driver<a class="headerlink" href="#ad9361-high-performance-highly-integrated-rf-agile-transceiver-linux-device-driver" title="Link to this heading">¶</a></h1>
<p>The AD9361 is a high performance, highly integrated RF Agile Transceiver™. Its programmability and wideband capability make it ideal for a broad range of transceiver applications. The device combines an RF front end with a flexible mixed-signal baseband section and integrated frequency synthesizers, simplifying design-in by providing a configurable digital interface to a processor.</p>
<section id="supported-devices">
<h2>Supported Devices<a class="headerlink" href="#supported-devices" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://analog.com/AD9361">AD9361</a></p></li>
<li><p><a class="reference external" href="https://analog.com/AD9363">AD9363</a></p></li>
<li><p><a class="reference external" href="https://analog.com/AD9364">AD9364</a></p></li>
</ul>
</section>
<section id="reference-circuits">
<h2>Reference Circuits<a class="headerlink" href="#reference-circuits" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://analog.com/AD-FMCOMMS2-EBZ">AD-FMCOMMS2-EBZ</a></p></li>
<li><p><a class="reference external" href="https://analog.com/AD-FMCOMMS3-EBZ">AD-FMCOMMS3-EBZ</a></p></li>
<li><p><a class="reference external" href="https://analog.com/AD-FMCOMMS4-EBZ">AD-FMCOMMS4-EBZ</a></p></li>
<li><p><a class="reference external" href="https://analog.com/AD-FMCOMMS5-EBZ">AD-FMCOMMS5-EBZ</a></p></li>
</ul>
</section>
<section id="evaluation-boards">
<h2>Evaluation Boards<a class="headerlink" href="#evaluation-boards" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://analog.com/AD-FMCOMMS2-EBZ">AD-FMCOMMS2-EBZ</a></p></li>
<li><p><a class="reference external" href="https://analog.com/AD-FMCOMMS3-EBZ">AD-FMCOMMS3-EBZ</a></p></li>
<li><p><a class="reference external" href="https://analog.com/AD-FMCOMMS4-EBZ">AD-FMCOMMS4-EBZ</a></p></li>
<li><p><a class="reference external" href="https://analog.com/AD-FMCOMMS5-EBZ">AD-FMCOMMS5-EBZ</a></p></li>
</ul>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This is a Linux industrial I/O (<a class="reference internal" href="#/software/linux/docs/iio/iio"><span class="xref myst">IIO</span></a>) subsystem driver, targeting RF Transceivers.
The industrial I/O subsystem provides a unified framework for drivers for many different types of converters and sensors using a number of different physical interfaces (i2c, spi, etc).
See <a class="reference internal" href="#/software/linux/docs/iio/iio"><span class="xref myst">IIO</span></a> for more information.</p>
</section>
<section id="source-code">
<h2>Source Code<a class="headerlink" href="#source-code" title="Link to this heading">¶</a></h2>
<section id="status">
<h3>Status<a class="headerlink" href="#status" title="Link to this heading">¶</a></h3>
<table>
<thead>
<tr class="header">
<th>Source</th>
<th>Mainlined?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/adc/ad9361.c">git</a></td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/adc/ad9361.c">No</a></td>
</tr>
</tbody>
</table>
</section>
<section id="files">
<h3>Files<a class="headerlink" href="#files" title="Link to this heading">¶</a></h3>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>File</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>driver</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/adc/ad9361.c">drivers/iio/adc/ad9361.c</a></td>
</tr>
<tr class="even">
<td>driver</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/adc/ad9361_conv.c">drivers/iio/adc/ad9361_conv.c</a></td>
</tr>
<tr class="odd">
<td>include</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/adc/ad9361.h">drivers/iio/adc/ad9361.h</a></td>
</tr>
<tr class="even">
<td>devicetree bindings</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?Documentation/devicetree/bindings/iio/adc/adi,ad9361.txt">Documentation/devicetree/bindings/iio/adc/adi,ad9361.txt</a></td>
</tr>
</tbody>
</table>
<section id="related-device-drivers">
<h4>Related Device Drivers<a class="headerlink" href="#related-device-drivers" title="Link to this heading">¶</a></h4>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>File</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>driver</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/adc/cf_axi_adc_core.c">drivers/iio/adc/cf_axi_adc_core.c</a></td>
</tr>
<tr class="even">
<td>driver</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/adc/cf_axi_adc_ring_stream.c">drivers/iio/adc/cf_axi_adc_ring_stream.c</a></td>
</tr>
<tr class="odd">
<td>include</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/adc/cf_axi_adc.h">drivers/iio/adc/cf_axi_adc.h</a></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>File</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>driver</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/frequency/cf_axi_dds.c">drivers/iio/frequency/cf_axi_dds.c</a></td>
</tr>
<tr class="even">
<td>include</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?drivers/iio/frequency/cf_axi_dds.h">drivers/iio/frequency/cf_axi_dds.h</a></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="device-driver-customization">
<h2>Device Driver Customization<a class="headerlink" href="#device-driver-customization" title="Link to this heading">¶</a></h2>
<p>Please follow the link here for detailed options and examples:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#/resources/tools-software/linux-drivers/iio-transceiver/ad9361-customization"><span class="xref myst">AD9361/AD9363/AD9364 Device Driver Customization</span></a></p></li>
</ul>
</section>
<section id="example-linux-device-tree-initialization">
<h2>Example Linux Device-Tree Initialization<a class="headerlink" href="#example-linux-device-tree-initialization" title="Link to this heading">¶</a></h2>
<p>The AD9361 driver is a spi-bus driver and can currently only be instantiated via device tree.</p>
<p>Required devicetree properties:</p>
<ul class="simple">
<li><p>compatible: Should always be “adi,ad9361”, “adi,ad9363” or “adi,ad9364”</p></li>
<li><p>reg: SPI slave select number</p></li>
</ul>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>File</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FMCOMMS2/3 Device Tree</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?arch/arm/boot/dts/adi-fmcomms2.dtsi">adi-fmcomms2.dtsi</a></td>
</tr>
<tr class="even">
<td>FMCOMMS4 Device Tree</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?arch/arm/boot/dts/adi-fmcomms4.dtsi">adi-fmcomms4.dtsi</a></td>
</tr>
<tr class="odd">
<td>FMCOMMS5 Device Tree</td>
<td><a href="https://github.com/analogdevicesinc/linux/main?arch/arm/boot/dts/adi-fmcomms5.dtsi">adi-fmcomms5.dtsi</a></td>
</tr>
</tbody>
</table>
</section>
<section id="enabling-linux-driver-support">
<h2>Enabling Linux driver support<a class="headerlink" href="#enabling-linux-driver-support" title="Link to this heading">¶</a></h2>
<p>Configure kernel with “make menuconfig” (alternatively use “make xconfig” or
“make qconfig”)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: round="" help="" -->
<p>The AD9361 driver depends on <strong>CONFIG_SPI</strong></p>
</div>
</section>
<section id="adding-linux-driver-support">
<h2>Adding Linux driver support<a class="headerlink" href="#adding-linux-driver-support" title="Link to this heading">¶</a></h2>
<p>Configure kernel with “make menuconfig” (alternatively use “make xconfig” or
“make qconfig”)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Linux Kernel Configuration
    Device Drivers  ---&gt;
    &lt;*&gt;     Industrial I/O support ---&gt;
        --- Industrial I/O support
        -*-   Enable ring buffer support within IIO
        -*-     Industrial I/O lock free software ring
        -*-   Enable triggered sampling support

              *** Analog to digital converters ***
        [--snip--]

        &lt;*&gt;   Analog Devices AD9467 AD9643 High-Speed AXI ADC driver

        [--snip--]
</pre></div>
</div>
</section>
<section id="hardware-configuration">
<h2>Hardware configuration<a class="headerlink" href="#hardware-configuration" title="Link to this heading">¶</a></h2>
</section>
<section id="driver-testing-api">
<h2>Driver testing / API<a class="headerlink" href="#driver-testing-api" title="Link to this heading">¶</a></h2>
<!-- CMDS: noheader firstseconly noeditbtn -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: top="" tip="" round="" box="" 60%="" -->
<p><strong>TIP:</strong>
An example program which uses the interface can be found here:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#/resources/tools-software/linux-software/iio_oscilloscope"><span class="xref myst">IIO Oscilloscope</span></a></p></li>
<li><p><a class="reference internal" href="#/resources/tools-software/linux-software/fmcomms2_plugin"><span class="xref myst">AD936X Plugin Description</span></a></p></li>
</ul>
</div>
<section id="general-attribute-naming-convention">
<h3>General attribute naming convention:<a class="headerlink" href="#general-attribute-naming-convention" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">in_voltage0_[…]</span></code>: targets RX1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in_voltage1_[…]</span></code>: targets RX2 (AD9361 in 2RX2TX mode only)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out_voltage0_[…]</span></code>: targets TX1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out_voltage1_[…]</span></code>: targets TX2 (AD9361 in 2RX2TX mode only)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out_altvoltage0_[…]</span></code>: targets RX LO</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out_altvoltage1_[…]</span></code>: targets TX LO</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: tip="" -->
<p>Because of differences in silicon implementation; and the way an IIO device wants to be expressed as a device with channels and attributes, there may be specific attributes that are exposed on multiple channels, that control the same bit/register in the device (are duplicated for convenience or to match the IIO model). A specific example of this is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">in_voltage0_rf_port_select</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in_voltage1_rf_port_select</span></code></p></li>
</ul>
<p>There is only one bit in the device that controls both channels, and this is provided for convenience.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/&gt;<span class="w"> </span>**cd<span class="w"> </span>/sys/bus/iio/devices/**
root:/sys/bus/iio/devices&gt;<span class="w"> </span>ls
iio:device0<span class="w"> </span>iio:device1<span class="w"> </span>iio:device2<span class="w"> </span>iio:device3<span class="w"> </span>iio:device4

root:/sys/bus/iio/devices&gt;<span class="w"> </span>**cd<span class="w"> </span>iio:device1**

root:/sys/bus/iio/devices/iio:device1#<span class="w"> </span>ls<span class="w"> </span>-l
total<span class="w"> </span><span class="m">0</span>
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>calib_mode
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>calib_mode_available
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>dcxo_tune_coarse
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>dcxo_tune_fine
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>dev
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>ensm_mode
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>ensm_mode_available
--w-------<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>filter_fir_config
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>in_out_voltage_filter_fir_en
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_temp0_input
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>in_voltage0_gain_control_mode
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>in_voltage0_hardwaregain
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>in_voltage0_rf_port_select
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_voltage0_rssi
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>in_voltage1_gain_control_mode
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>in_voltage1_hardwaregain
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_voltage1_rf_port_select
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_voltage1_rssi
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_voltage2_offset
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_voltage2_raw
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_voltage2_scale
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>in_voltage_bb_dc_offset_tracking_en
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>in_voltage_filter_fir_en
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_voltage_gain_control_mode_available
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>in_voltage_quadrature_tracking_en
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>in_voltage_rf_bandwidth
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>in_voltage_rf_dc_offset_tracking_en
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>in_voltage_rf_port_select_available
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>in_voltage_sampling_frequency
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>name
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_load
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_recall
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_save
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_store
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>out_altvoltage0_RX_LO_frequency
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_altvoltage1_TX_LO_fastlock_load
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_altvoltage1_TX_LO_fastlock_recall
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_altvoltage1_TX_LO_fastlock_save
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_altvoltage1_TX_LO_fastlock_store
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>out_altvoltage1_TX_LO_frequency
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>out_voltage0_hardwaregain
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>out_voltage0_rf_port_select
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_voltage0_rssi
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>out_voltage1_hardwaregain
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_voltage1_rf_port_select
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_voltage1_rssi
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_voltage2_raw
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_voltage2_scale
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_voltage3_raw
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_voltage3_scale
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>out_voltage_filter_fir_en
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:32<span class="w"> </span>out_voltage_rf_bandwidth
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>out_voltage_rf_port_select_available
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>out_voltage_sampling_frequency
drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">0</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>power
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>rx_path_rates
lrwxrwxrwx<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">0</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>subsystem<span class="w"> </span>-&gt;<span class="w"> </span>../../../../../../../../bus/iio
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:33<span class="w"> </span>trx_rate_governor
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>trx_rate_governor_available
-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>tx_path_rates
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">13</span>:49<span class="w"> </span>uevent

root:/sys/bus/iio/devices/iio:device1#
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="show-device-name">Show device name</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>name**
ad9361-phy
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="enable-state-machine-controls">Enable State Machine Controls</h3>
<p>The AD9361 transceiver includes an Enable State Machine (ENSM), allowing real time control over the current state of the device. The ENSM has two possible control methods – SPI control (writing ensm_mode), and pin control (writing ensm_mode = pinctrl).
The ENSM is controlled asynchronously by writing SPI registers to advance the current state to the next state.
The ENABLE and TXNRX pins allow real time control of the current state.
The ENSM allows TDD or FDD operation depending on the configuration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>ensm_mode_available**
sleep<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>alert<span class="w"> </span>fdd<span class="w"> </span>pinctrl<span class="w"> </span>pinctrl_fdd_indep
</pre></div>
</div>
<div class="docutils">
<p><strong>FDD Mode options:</strong></p>
<ul class="simple">
<li><p>sleep</p></li>
<li><p>alert</p></li>
<li><p>fdd</p></li>
<li><p>pinctrl</p></li>
<li><p>pinctrl_fdd_indep (FDD Independent Mode)</p></li>
</ul>
<p><strong>TDD Mode options:</strong></p>
<ul class="simple">
<li><p>sleep</p></li>
<li><p>alert</p></li>
<li><p>rx</p></li>
<li><p>tx</p></li>
<li><p>pinctrl</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>ensm_mode**
fdd

root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span>alert<span class="w"> </span>&gt;<span class="w"> </span>ensm_mode**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>ensm_mode**
alert
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: left="" tip="" round="" box="" 100%="" -->
<p><strong>NOTE:</strong>
Be aware if you you want to transition in TDD mode from RX to TX you have to go via ALERT.
(Recent driver releases - do this now automatically…)</p>
<p>You may want to checkout the ENSM Pin-Control test script here:
<a class="reference external" href="https://github.com/analogdevicesinc/linux_image_ADI-scripts/blob/master/test_ensm_pinctrl.sh">test_ensm_pinctrl.sh</a></p>
</div>
</div>
</section>
<section id="local-oscillator-control-lo">
<h3>Local Oscillator Control (LO)<a class="headerlink" href="#local-oscillator-control-lo" title="Link to this heading">¶</a></h3>
<p>The AD9361 transceiver contains two identical RFPLL synthesizers to generate the required LO signals.
One is programmed for the RX channel and the other for the TX channel.
The tuning range supported by this driver covers 70MHz to 6GHz (AD9363: 325-3800 MHz) with 2Hz tuning granularity.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>**cat<span class="w"> </span>out_altvoltage0_RX_LO_frequency**
<span class="m">2400000000</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">2450000000</span><span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage0_RX_LO_frequency**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_altvoltage0_RX_LO_frequency**
<span class="m">2450000000</span>
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="local-oscillator-power-down">Local Oscillator Power-down</h4>
<p>If both, the TX and RX Local Oscillators (LO) are set to the same frequency or very close to each other.
The TX LO may leak into the RX path. Usually this is avoided in TDD mode, since always only one of the LOs is enabled at a given time. However sometimes it can be beneficial in FDD mode to turn the TX LO off. Care must be taken since TX LO in Power-down mode, will cause the TX QUAD calibration to fail.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage1_TX_LO_powerdown**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_altvoltage1_TX_LO_powerdown**
<span class="m">0</span>
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_altvoltage0_RX_LO_powerdown**
<span class="m">1</span>
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="external-lo-support">External LO Support</h4>
<p>The driver allows switching between external and internal LO on the fly.
Writing 1 into out_altvoltage0_RX_LO_external/out_altvoltage1_TX_LO_external switches to external LO.
Respectively writing 0 switches back to the internal synthesizer.</p>
<p>In case additional clocks are specified in the device tree (clock-names: “ext_tx_lo” “ext_rx_lo”).
The driver automatically controls the external clock/PLL Synthesizer.</p>
<note tip>
This feature does not exist on the AD9363
</note>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    adc0_ad9361: ad9361-phy@0 {

        compatible = &quot;adi,ad9361&quot;;


        /* Clocks */
        clocks = &lt;&amp;ad9361_clkin&gt;, &lt;&amp;ad9361_ext_tx_lo&gt;, &lt;&amp;ad9361_ext_rx_lo&gt;;
        clock-names = &quot;ad9361_ext_refclk&quot;, &quot;ext_tx_lo&quot;, &quot;ext_rx_lo&quot;;
        clock-output-names = &quot;rx_sampl_clk&quot;, &quot;tx_sampl_clk&quot;;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>**cat<span class="w"> </span>out_altvoltage0_RX_LO_frequency**
<span class="m">2400000000</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage0_RX_LO_external**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_altvoltage0_RX_LO_external**
<span class="m">1</span>
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="fastlock-mode">FASTLOCK MODE</h4>
<p>The device includes a Fast Lock mode that makes it possible to achieve faster than normal frequency changes by storing sets of synthesizer programming information (called “profiles”) either into device registers or the BB processor’s memory space to be recalled at a later time.
The Fast Lock mode eliminates most of the overhead of synthesizer programming by allowing up to 8 full RX profiles and 8 full TX profiles of frequency configuration information (including VCO cal results) to be stored in the device for faster frequency changes.
In order to use a particular profile, first it must be configured. Typically, this would be accomplished at powerup, but a new or updated profile can be defined at any convenient time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: left="" tip="" round="" box="" 100%="" -->
<p><strong>NOTE:</strong>
You may want to checkout the Fastlock Pin-Control test script here:
<a class="reference external" href="https://github.com/analogdevicesinc/linux_image_ADI-scripts/blob/master/test_tx_fastlock_pinctrl.sh">test_tx_fastlock_pinctrl.sh</a></p>
</div>
</div>
<section id="create-profile">
<h4>Create Profile<a class="headerlink" href="#create-profile" title="Link to this heading">¶</a></h4>
<p>To create a profile tune the synthesizer and then write the target profile number into out_altvoltageX_fastlock_store.</p>
<p>Valid profile range is from 0…7</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">4242000000</span><span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage0_RX_LO_frequency**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_store**
</pre></div>
</div>
<div class="docutils">
<h5 class="rubric" id="recall-profile">Recall Profile</h5>
<p>To recall a profile write the target profile number into out_altvoltageX_fastlock_recall.
Valid profile range is from 0…7.</p>
<p>Reading out_altvoltageX_fastlock_recall returns the current profile number
or –EINVAL if in normal synthesizer mode.</p>
<p>When in fastlock pin select mode (adi,[tx|rx]-fastlock-pincontrol-enable).
This file needs to be written once with a value, before the pin-control can be used.
This will moves the device into fastlock mode.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_recall**
</pre></div>
</div>
<div class="docutils">
<h5 class="rubric" id="saving-a-profile">Saving a Profile</h5>
<p>In order to use more than 8 Profiles – an existing profile can be read back and stored by the user application.</p>
<p>The format is: Profile# val0,val1,val2,…,val15</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_save<span class="w"> </span>**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**<span class="w"> </span>cat<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_save<span class="w"> </span>**
<span class="m">0</span><span class="w"> </span><span class="m">240</span>,0,202,204,12,80,24,16,187,255,60,238,113,233,93,174
</pre></div>
</div>
<div class="docutils">
<h5 class="rubric" id="loading-a-profile">Loading a Profile</h5>
<p>A previously saved profile can be loaded in any of the 8 available slots.
Write the profile string into out_altvoltageX_fastlock_load</p>
<p>The format is: Profile# val0,val1,val2,…,val15</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">240</span>,0,202,204,12,80,24,16,187,255,60,238,113,233,93,174<span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage0_RX_LO_fastlock_load<span class="w"> </span>**
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="rx-signal-path">RX Signal Path</h3>
<p>The AD9361 RX signal path passes downconverted signals (I and Q) to the baseband receiver section. The baseband RX signal path is composed of two programmable analog low-pass filters, a 12-bit ADC, and four stages of digital decimating filters. Each of the four decimating filters can be bypassed. The corner frequency for each low-pass filter is programmable via SPI registers. Figure below shows a block diagram for the AD9361 RX signal path. Note that both the I and Q paths are schematically identical to each other.</p>
<img alt="../../../_images/rx_signal_path.png" src="../../../_images/rx_signal_path.png" />
<p>The high level in_voltage_sampling_frequency attribute effectively controls the BBPLL frequency the ADC Sample clock and all following decimating filter blocks except the FIR block which is handled upon user configuration.
This IIO device attribute allows the user to control the Baseband (BB) Sample Rate in Hz granularity in the range from 521KSPS up to 61.44MSPS, also depending on the FIR filter decimation chosen.
in_voltage_sampling_frequency as well as out_voltage_sampling_frequency are not entirely independent, by default the both need to match unless adi,fdd-rx-rate-2tx-enable is enabled.
Then RX rate can be twice the TX rate.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: left="" tip="" round="" box="" 100%="" -->
<p><strong>NOTE:</strong>
In the minimum ADC rate is 25MSPS.
Baseband rates below 2.083 MSPS (25MSPS/12) require FIR decimation/interpolation to be set.
In other words the FIR filter needs to be configured and enabled.
The minimum baseband rate with the FIR filter (decimate by 4) enabled is: 25MSPS /(4*12) = 520.83 kSPS.</p>
<p>Some example filters can be found here:<a class="reference external" href="https://github.com/analogdevicesinc/iio-oscilloscope/tree/master/filters">filters</a></p>
</div>
</div>
</section>
<section id="setting-querying-the-rx-sample-rate">
<h4>Setting / Querying the RX Sample Rate<a class="headerlink" href="#setting-querying-the-rx-sample-rate" title="Link to this heading">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_sampling_frequency**
<span class="m">30720000</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">10000000</span><span class="w"> </span>&gt;<span class="w"> </span>in_voltage_sampling_frequency**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_sampling_frequency**
<span class="m">10000000</span>
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="list-chosen-rx-path-rates">List chosen RX Path Rates</h4>
<p>This attribute lists the current rates in the various digital blocks.</p>
<table>
<thead>
<tr class="header">
<th>Stage</th>
<th>Description</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BBPLL</td>
<td>The Baseband PLL frequency</td>
<td></td>
</tr>
<tr class="even">
<td>ADC</td>
<td>The ADC sample rate</td>
<td>BBPLL/ADC = BBPLL divider</td>
</tr>
<tr class="odd">
<td>R2</td>
<td>Rate of the HB3/DEC3 filter</td>
<td>ADC/R2 = HB3 decimation factor</td>
</tr>
<tr class="even">
<td>R1</td>
<td>Rate of the HB2 filter</td>
<td>R2/R1 = HB2 decimation factor</td>
</tr>
<tr class="odd">
<td>RF</td>
<td>Rate of the HB1 filter</td>
<td>R1/RF = HB1 decimation factor</td>
</tr>
<tr class="even">
<td>RXSAMP</td>
<td>RX sampling rate or baseband rate</td>
<td>RF/RXSAMP = FIR decimation factor</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>rx_path_rates**
BBPLL:983040000<span class="w"> </span>ADC:245760000<span class="w"> </span>R2:122880000<span class="w"> </span>R1:61440000<span class="w"> </span>RF:30720000<span class="w"> </span>RXSAMP:30720000
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="tx-signal-path">TX Signal Path</h3>
<p>The AD9361 TX signal path receives 12-bit 2s complement data in I-Q format from the AD9361 digital interface, and each channel (I and Q) passes this data through four digital interpolating filters to a 12-bit DAC. Each of the four interpolating filters can be bypassed. The DAC’s analog output is passed through two low pass filters prior to the RF mixer. The corner frequency for each low-pass filter is programmable via SPI registers. Figure 1 shows a block diagram for the AD9361 TX signal path. Note that both the I and the Q paths are schematically identical to each other. The four blocks leading up to the DAC in shown figure below comprise the digital filtering for the transmit path. These programmable filters provide the bandwidth limiting required prior to conversion from digital to analog. They also provide interpolation to translate from the input data rate to the rate needed for proper digital to analog conversion. In each filter, interpolation is performed first, followed by the filter transfer function.</p>
<img alt="../../../_images/tx_signal_path.png" src="../../../_images/tx_signal_path.png" />
<p>The high level out_voltage_sampling_frequency attribute effectively controls the BBPLL frequency the ADC Sample clock, the DAC clock and all following interpolation filter blocks except the FIR block which is handled upon user configuration.
This IIO device attribute allows the user to control the Baseband (BB) Sample Rate in Hz granularity in the range from 218KSPS up to 61.44MSPS, also depending on the FIR filter decimation chosen.
out_voltage_sampling_frequency as well as in_voltage_sampling_frequency are not entirely independent, by default the both need to match unless adi,fdd-rx-rate-2tx-enable is set.
Then RX rate can be twice the TX rate, however this mode needs to be supported by the FPGA/Baseband-Processor.
The feedback clock must be externally divided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: left="" tip="" round="" box="" 100%="" -->
<p><strong>NOTE:</strong>
In the minimum ADC rate is 25MSPS.
Baseband rates below 2.083 MSPS (25MSPS/12) require FIR decimation/interpolation to be set.
In other words the FIR filter needs to be configured and enabled.
The minimum baseband rate with the FIR filter (decimate by 4) enabled is: 25MSPS /(4*12) = 520.83 kSPS.</p>
<p>Some example filters can be found here:<a class="reference external" href="https://github.com/analogdevicesinc/iio-oscilloscope/tree/master/filters">filters</a></p>
</div>
</div>
</section>
<section id="setting-querying-the-tx-sample-rate">
<h4>Setting / Querying the TX Sample Rate<a class="headerlink" href="#setting-querying-the-tx-sample-rate" title="Link to this heading">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage_sampling_frequency**
<span class="m">30720000</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">10000000</span><span class="w"> </span>&gt;<span class="w"> </span>out<span class="w"> </span>_voltage_sampling_frequency**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out<span class="w"> </span>_voltage_sampling_frequency**
<span class="m">10000000</span>
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="list-chosen-tx-path-rates">List chosen TX Path Rates</h4>
<p>This attribute lists the current rates in the various digital blocks.</p>
<table>
<thead>
<tr class="header">
<th>Stage</th>
<th>Description</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TXSAMP</td>
<td>TX sample rate or baseband rate</td>
<td>TF/TXSAMP = FIR interpolation factor</td>
</tr>
<tr class="even">
<td>TF</td>
<td>Rate of the HB1 filter</td>
<td>T1/TF = HB1 interpolation factor</td>
</tr>
<tr class="odd">
<td>T1</td>
<td>Rate of the HB2 filter</td>
<td>T2/T1 = HB2 interpolation factor</td>
</tr>
<tr class="even">
<td>T2</td>
<td>Rate of the HB3/INT3 filter</td>
<td>DAC/T2 = HB3 interpolation factor</td>
</tr>
<tr class="odd">
<td>DAC</td>
<td>The DAC sample rate</td>
<td>ADC/DAC = DAC clock divider</td>
</tr>
<tr class="even">
<td>BBPLL</td>
<td>The Baseband PLL frequency</td>
<td>BBPLL/ADC = BBPLL divider</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>tx_path_rates**
BBPLL:983040000<span class="w"> </span>DAC:122880000<span class="w"> </span>T2:122880000<span class="w"> </span>T1:61440000<span class="w"> </span>TF:30720000<span class="w"> </span>TXSAMP:30720000
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="rate-governors">Rate Governors</h3>
<p>The rate governor option allows the user to influence the ADC sample rate and decimation/interpolation rates chosen in the followed digital blocks.
It mainly influences whether RX HB3/DEC3/ and TX HB3/INT3 decimates/interpolates by 3 or 2, thus resulting in an higher oversampling rate.
Decimate by 3 doesn’t necessarily produce higher performance. Therefore the default setting of Nominal is always a good option.</p>
<h4 class="rubric" id="list-available-rate-governors">List available Rate Governors</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>trx_rate_governor_available**
nominal<span class="w"> </span>highest_osr
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="selecting-rate-governor">Selecting Rate Governor</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>trx_rate_governor**
highest_osr
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span>nominal<span class="w"> </span>&gt;<span class="w"> </span>trx_rate_governor**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>trx_rate_governor**
nominal
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="digital-fir-filter-controls">Digital FIR Filter controls</h3>
<p>The last/first digital filter in the RX/TX signal path is a programmable poly-phase FIR filter. The RX/TX FIR filter can decimate/interpolate by a factor of 1, 2, or 4, or it can be bypassed if not needed. The filter taps are configurable in groups of 16 between a minimum of 16 and a maximum of 128 taps. The RX FIR also has a programmable gain of -12dB, -6dB, 0dB, or +6dB. The filter provides a fixed +6dB gain to maximize dynamic range, so the programmable gain is typically set to -6dB to produce a net gain of 0dB. The TX FIR also has a programmable gain setting of 0dB or -6dB. Be aware there are some limitations in terms of the maximum number of taps supported by the different clock ratios, please consult the AD9361 manual for more details.
The AD9361 device driver will warn if a programmed filter doesn’t match the limits.</p>
<p>In general the filters are either created using the:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#/resources/eval/user-guides/ad-fmcomms2-ebz/software/filters"><span class="xref myst">MATLAB Filter Design Wizard for AD9361</span></a></p></li>
<li><p><a class="reference external" href="https://github.com/analogdevicesinc/libad9361-iio">libad9361-iio</a></p></li>
</ol>
<p>Some per-generated examples can be found here: <a class="reference external" href="https://github.com/analogdevicesinc/iio-oscilloscope/tree/master/filters">AD936x example filters</a></p>
<h4 class="rubric" id="query-current-filter-configuration">Query current filter Configuration</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>filter_fir_config**
FIR<span class="w"> </span>Rx<span class="w"> </span><span class="m">0</span>,0<span class="w"> </span>Tx<span class="w"> </span><span class="m">0</span>,0
</pre></div>
</div>
<div class="docutils">
<p>Return Value:
<strong>Rx</strong> <Num Taps>,<Decimation factor> <strong>Tx</strong> <Num Taps>,<Interpolation factor></p>
<h4 class="rubric" id="load-a-filter">Load a Filter</h4>
<p>Query current filter Configuration</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>LTE20.txt<span class="w"> </span>&gt;<span class="w"> </span>filter_fir_config**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>filter_fir_config**
FIR<span class="w"> </span>Rx<span class="w"> </span><span class="m">128</span>,2<span class="w"> </span>Tx<span class="w"> </span><span class="m">128</span>,2
</pre></div>
</div>
<div class="docutils">
<p>Each file requires a short header:</p>
<ul class="simple">
<li><p>Lines prefixed with ‘#’ are ignored</p></li>
<li><p>Coefficients are signed 16-bit numbers</p></li>
<li><p>Multiple filter files can be loaded until each RX and each TX has its own set of coefficients</p></li>
<li><p>Syntax and examples shown below</p></li>
</ul>
<h5 class="rubric" id="syntax">Syntax</h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>**RX**<span class="w"> </span><span class="o">[</span><span class="m">1</span>,2,3<span class="o">(</span>both<span class="o">)]</span><span class="w"> </span>**GAIN**<span class="w"> </span><span class="o">[</span>-12,<span class="w"> </span>-6,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">6</span><span class="o">]</span><span class="w"> </span>**DEC**<span class="w"> </span><span class="o">[</span><span class="m">1</span>,2,4<span class="o">]</span>
**TX**<span class="w"> </span><span class="o">[</span><span class="m">1</span>,2,3<span class="o">(</span>both<span class="o">)]</span><span class="w"> </span>**GAIN**<span class="w"> </span><span class="o">[</span>-6,<span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w"> </span>**INT**<span class="w"> </span><span class="o">[</span><span class="m">1</span>,2,4<span class="o">]</span>
<span class="o">[</span>**RRX**<span class="w"> </span>&lt;BBPLL<span class="w"> </span>ADC<span class="w"> </span>R2<span class="w"> </span>R1<span class="w"> </span>RF<span class="w"> </span>RXSAMP&gt;<span class="o">]</span>
<span class="o">[</span>**RTX**<span class="w"> </span>&lt;BBPLL<span class="w"> </span>DAC<span class="w"> </span>T2<span class="w"> </span>T1<span class="w"> </span>TF<span class="w"> </span>TXSAMP&gt;<span class="o">]</span>
<span class="o">[</span>**BWRX**<span class="w"> </span>&lt;RX<span class="w"> </span>RF<span class="w"> </span>Bandwidth&gt;<span class="o">]</span>
<span class="o">[</span>**BWTX**<span class="w"> </span>&lt;RX<span class="w"> </span>TF<span class="w"> </span>Bandwidth&gt;<span class="o">]</span>
&lt;tx-coef0,<span class="w"> </span>rx-coef0&gt;
&lt;tx-coef1,<span class="w"> </span>rx-coef1&gt;
&lt;...,<span class="w"> </span>...&gt;
&lt;tx-coefN-1,<span class="w"> </span>rx-coefN-1&gt;
</pre></div>
</div>
<h5 class="rubric" id="examples">Examples</h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#RX [1,2,3(both)] GAIN [-12, -6, 0, 6] DEC [1,2,4]
#TX [1,2,3(both)] GAIN [-6, 0] INT [1,2,4]
#tx,rx
RX 3 GAIN -6 DEC 2
TX 3 GAIN 0 INT 2
RTX 983040000 245760000 245760000 122880000 61440000 30720000
RRX 983040000 491520000 245760000 122880000 61440000 30720000
BWTX 19365438
BWRX 19365514
-5,49
0,217
--snip--

#RX [1,2,3(both)] GAIN [-12, -6, 0, 6] DEC [1,2,4]
#TX [1,2,3(both)] GAIN [-6, 0] INT [1,2,4]
#tx,rx
RX 3 GAIN -6 DEC 2
-5
0
--snip--

#RX [1,2,3(both)] GAIN [-12, -6, 0, 6] DEC [1,2,4]
#TX [1,2,3(both)] GAIN [-6, 0] INT [1,2,4]
#tx,rx
TX 3 GAIN 0 INT 2
49
217
--snip--
</pre></div>
</div>
<h5 class="rubric" id="filter-enable-disable">Filter Enable / Disable</h5>
<p>To enable or disable the RX or TX path filters simply write 0,N or 1,Y to one of below
control files. Combo attribute in_out_voltage_filter_fir_en allows to simultaneously enable both filters.
This might sometimes be necessary, depending on the RX/TX Path Sampling Frequency and FIR interpolation and decimation rates chosen.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_filter_fir_en**
<span class="m">0</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>in_voltage_filter_fir_en**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_filter_fir_en**
<span class="m">1</span>
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage_filter_fir_en**
<span class="m">0</span>
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_out_voltage_filter_fir_en**
<span class="m">0</span>
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="rf-bandwidth-analog-filter-control">RF Bandwidth Analog Filter Control</h3>
<h4 class="rubric" id="rx-rf-bandwidth-control">RX RF Bandwidth Control</h4>
<p>The AD9361 features several Rx Analog Filter Blocks (RX TIA LPF, RX BB LPF)
Analog filtering before the ADC reduces spurious signal levels by removing mixer products and providing general low pass filtering prior to downconversion.
The RX TIA LPF is a single-pole low-pass filter with a programmable 3dB corner frequency.
The RX BB LPF is a third-order Butterworthlow-passfilter with a programmable 3dB corner frequency.</p>
<p>These filters can be set by writing a single device attribute (in_voltage_rf_bandwidth)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_rf_bandwidth**
<span class="m">18000000</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">9000000</span><span class="w"> </span>&gt;<span class="w"> </span>in_voltage_rf_bandwidth**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_rf_bandwidth**
<span class="m">9000000</span>
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="tx-rf-bandwidth-control">TX RF Bandwidth Control</h4>
<p>The AD9361 features several Tx Analog Filter Blocks (TX BB LPF, TX Secondary LPF)
Analog filtering after the DAC reduces spurious outputs by removing sampling artifacts and providing general low pass filtering prior to upconversion.
The TX BB LPF is a third-order Butterworth low-pass filter with a programmable 3dB corner frequency.
The TX Secondary LPF is a single-polelow-passfilter with a programmable 3dB corner frequency.</p>
<p>These filters can be set by writing a single device attribute (out_voltage_rf_bandwidth)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage_rf_bandwidth**
<span class="m">18000000</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">9000000</span><span class="w"> </span>&gt;<span class="w"> </span>out_voltage_rf_bandwidth**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage_rf_bandwidth**
<span class="m">9000000</span>
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="rx-gain-control">RX Gain Control</h3>
<p>The versatile and highly configurable AD9361 transceiver has several gain control modes that enable its use in a variety of applications. Fully automatic gain control (AGC) modes are available that address time division duplex (TDD) as well as frequency division duplex (FDD) scenarios. In addition, the AD9361 has manual gain control (MGC) options that allow the baseband processor (BBP) to control the gain.</p>
<p>The default ADI provided optimized gain tables in full table mode provide 77 entries and in split gain table mode 41.
Each index results typically in a 1 dB monotonic gain step. There are a total of 3 different tables available for different RX LO frequency ranges. The tables are swapped in and out automatically by the driver based on RX LO settings.</p>
<p>Standard Tables:</p>
<table>
<thead>
<tr class="header">
<th>RX LO Range</th>
<th>Min GAIN</th>
<th>Max Gain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>70 ... 1300 MHz</td>
<td>-1 dB</td>
<td>73 dB</td>
</tr>
<tr class="even">
<td>1300 ... 4000 MHz</td>
<td>-3 dB</td>
<td>71 dB</td>
</tr>
<tr class="odd">
<td>4000 ... 6000 MHz</td>
<td>-10 dB</td>
<td>62 dB</td>
</tr>
</tbody>
</table>
<p>Custom gain tables can be loaded automatically during driver probe or anytime later via the gain_table_config sysfs attribute.
Tables must be stored in the /lib/firmware folder, or compiled into the kernel using the CONFIG_FIRMWARE_IN_KERNEL, CONFIG_EXTRA_FIRMWARE config options.
The table loaded during driver probe can be specified using following device tree property:</p>
<p><strong>adi,gaintable-name</strong> = “ad9361_std_gaintable”;</p>
<p>In case no table is specified or loaded, the driver will continue to use the provided standard gain tables.</p>
<p>Gain tables are stored in a human readable file, with the format specified below. Up to 15 gain tables (for different frequency ranges, or gain table modes) can be provided in a single file.</p>
<p>Example: <a class="reference external" href="https://github.com/analogdevicesinc/linux/main?firmware/ad9361_std_gaintable">ad9361_std_gaintable</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;list&gt;   
 &lt;gaintable [AD9361|AD9364] type=[FULL|SPLIT] dest=[1|2|3] start=FREQUENCY1_Hz end=FREQUENCY2_Hz&gt;
 gain_in_dB, reg_0x131, reg_0x132, reg_0x133
 gain_in_dB, reg_0x131, reg_0x132, reg_0x133
 gain_in_dB, reg_0x131, reg_0x132, reg_0x133
 …
 &lt;/gaintable&gt;

...

&lt;/list&gt;
</pre></div>
</div>
<p><strong>Assumptions:</strong></p>
<ul class="simple">
<li><p>Gain tables must be monotonic</p></li>
<li><p>gain_in_dB: is the absolute Gain in dB (signed char format: -128…127)</p></li>
<li><p>reg_0x131: Ext LNA, Int LNA, &amp; Mixer Gain Word</p></li>
<li><p>reg_0x132: TIA &amp; LPF Word</p></li>
<li><p>reg_0x133: DC Cal bit &amp; Dig Gain Word</p></li>
<li><p>end must be greater than start frequency (in Hz)</p></li>
<li><p>There must be sufficient tables provided to support the entire used tuning range</p></li>
<li><p>dest specifies the targeted RX. (1 = RX1, 2=RX2, 3=RX1 and RX2) (not used at the moment default is always RX1 and RX2)</p></li>
</ul>
<h4 class="rubric" id="loading-a-gain-table">Loading a gain table</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@analog:/sys/bus/iio/devices/iio:device1#<span class="w"> </span>ls<span class="w"> </span>/lib/firmware/ad9*
ad9361_std_gaintable

root@analog:/sys/bus/iio/devices/iio:device1#<span class="w"> </span>cat<span class="w"> </span>/lib/firmware/ad9361_std_gaintable<span class="w"> </span>&gt;<span class="w"> </span>gain_table_config
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="reading-a-gain-table">Reading a gain table</h4>
<p>Reading the gain_table_config attribute returns the current gain table that is loaded into the transceiver IC.
The printed format matches the format used in the gaintable file.</p>
<p>Reading the gain table only displays the gain table that will be used with the current RX_LO frequency setting.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">2450000000</span><span class="w"> </span>&gt;<span class="w"> </span>out_altvoltage0_RX_LO_frequency
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>cat<span class="w"> </span>out_altvoltage0_RX_LO_frequency
<span class="m">2450000000</span>
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@analog:/sys/bus/iio/devices/iio:device1#<span class="w"> </span>cat<span class="w"> </span>gain_table_config
&lt;gaintable<span class="w"> </span>AD9361<span class="w"> </span><span class="nv">type</span><span class="o">=</span>FULL<span class="w"> </span><span class="nv">dest</span><span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="nv">start</span><span class="o">=</span><span class="m">1300000000</span><span class="w"> </span><span class="nv">end</span><span class="o">=</span><span class="m">4000000000</span>&gt;
-3,<span class="w"> </span>0x00,<span class="w"> </span>0x00,<span class="w"> </span>0x20
-3,<span class="w"> </span>0x00,<span class="w"> </span>0x00,<span class="w"> </span>0x00
-3,<span class="w"> </span>0x00,<span class="w"> </span>0x00,<span class="w"> </span>0x00
-2,<span class="w"> </span>0x00,<span class="w"> </span>0x01,<span class="w"> </span>0x00
-1,<span class="w"> </span>0x00,<span class="w"> </span>0x02,<span class="w"> </span>0x00
<span class="m">0</span>,<span class="w"> </span>0x00,<span class="w"> </span>0x03,<span class="w"> </span>0x00
<span class="m">1</span>,<span class="w"> </span>0x00,<span class="w"> </span>0x04,<span class="w"> </span>0x00
<span class="m">2</span>,<span class="w"> </span>0x00,<span class="w"> </span>0x05,<span class="w"> </span>0x00
<span class="m">3</span>,<span class="w"> </span>0x01,<span class="w"> </span>0x03,<span class="w"> </span>0x20
<span class="m">4</span>,<span class="w"> </span>0x01,<span class="w"> </span>0x04,<span class="w"> </span>0x00
<span class="m">5</span>,<span class="w"> </span>0x01,<span class="w"> </span>0x05,<span class="w"> </span>0x00
<span class="m">6</span>,<span class="w"> </span>0x01,<span class="w"> </span>0x06,<span class="w"> </span>0x00
<span class="m">7</span>,<span class="w"> </span>0x01,<span class="w"> </span>0x07,<span class="w"> </span>0x00
<span class="m">8</span>,<span class="w"> </span>0x01,<span class="w"> </span>0x08,<span class="w"> </span>0x00

<span class="o">[</span>--snip--<span class="o">]</span>

<span class="m">69</span>,<span class="w"> </span>0x6D,<span class="w"> </span>0x38,<span class="w"> </span>0x20
<span class="m">70</span>,<span class="w"> </span>0x6E,<span class="w"> </span>0x38,<span class="w"> </span>0x20
<span class="m">71</span>,<span class="w"> </span>0x6F,<span class="w"> </span>0x38,<span class="w"> </span>0x20
&lt;/gaintable&gt;
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="gain-control-modes">Gain control modes</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_gain_control_mode_available**
manual<span class="w"> </span>fast_attack<span class="w"> </span>slow_attack<span class="w"> </span>hybrid
</pre></div>
</div>
<div class="docutils">
<table>
<thead>
<tr class="header">
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>manual</td>
<td>In MGC mode, the BBP controls the gain index pointer(s). In its simplest form, the BBP evaluates the digital signal level at the I/O port and then adjusts the gain appropriately. The BBP can control manual gain in one of two ways. The default method uses SPI writes (writing in_voltage[0,1]_hardwaregain) the total gain in dB. This results in different gain indices depending on the gain table loaded. Alternatively, the BBP can pulse the Control Input pins to move the gain indices.</td>
</tr>
<tr class="even">
<td>slow_attack</td>
<td>Slow Attack Mode is intended for slowly changing signals such as those found in some FDD applications such as WCDMA and FDD LTE. The Slow Attack AGC uses a 2nd order control loop with hysteresis that changes the gain in order to keep the average signal power within a programmable window</td>
</tr>
<tr class="odd">
<td>hybrid</td>
<td>The AGC hybrid mode is the same as the slow AGC mode with the exception that the gain update counter is not used. Instead, gain updates occur when the BBP pulls the CTRL_IN2 signal high. The “hybrid” term arises because the BBP has taken some control of the algorithm away from the AD9361 so gain control is no longer completely automatic.</td>
</tr>
<tr class="even">
<td>fast_attack</td>
<td>Fast Attack Mode is intended for waveforms that “burst” on and off, such as those found in TDD applications or GSM/EDGE FDD applications. The AGC responds very quickly to overloads at the start of a burst so that the AGC can settle to an optimum gain index by the time the data portion of the signal arrives.</td>
</tr>
</tbody>
</table>
<h4 class="rubric" id="querying-or-setting-a-gain-control-mode">Querying or Setting a Gain Control Mode</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage0_gain_control_mode**
slow_attack
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span>manual<span class="w"> </span>&gt;<span class="w"> </span>in_voltage0_gain_control_mode**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage0_gain_control_mode**
manual
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage1_gain_control_mode**
slow_attack
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="reading-the-current-gain">Reading the current Gain</h4>
<p>Supported in all available Gain control modes</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage0_hardwaregain**
<span class="m">61</span>.000000<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage1_hardwaregain**
<span class="m">71</span>.000000<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="mgc-setting-the-current-gain">MGC setting the current Gain</h4>
<p>Only available in Manual Gain Control Mode (MGC)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">42</span><span class="w"> </span>&gt;<span class="w"> </span>in_voltage0_hardwaregain**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage0_hardwaregain**
<span class="m">42</span>.000000<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="tx-attenuation-control">Tx Attenuation Control</h3>
<p>The TX attenuation/gain can be individually controlled for TX1 and TX2.
The range is from 0 to -89.75 dB in 0.25dB steps.
The nomenclature used here is gain instead of attenuation, so all values are expressed negative.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage0_hardwaregain**
-10.000000<span class="w"> </span>dB
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span>-42.25<span class="w"> </span>&gt;<span class="w"> </span>out_voltage0_hardwaregain**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage0_hardwaregain**
-42.250000<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage1_hardwaregain**
-10.000000<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="received-strength-signal-indicator-rssi">Received Strength Signal Indicator (RSSI)</h3>
<p>Given the wide variety of applications for which the AD9361 is suited, the received strength signal indicator (RSSI) may be setup in one of several configurations, allowing the user to optimize the RSSI to produce extremely accurate results with a minimum of BBP interaction. The AD9361 measures RSSI by measuring the power level in dB and compensating for the receive path gain. The various options available support both TDD and FDD applications. Note that the RSSI value is not in absolute units. Equating the RSSI read-back value to an absolute power level (e.g., in dBm) requires a system factory or bench calibration. To calibrate the RSSI word to an absolute reference, inject a signal into the antenna port of the completed system and read the RSSI word. From this test, generate a correction factor that equates the RSI word to the injected signal level at the antenna port.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage0_rssi**
<span class="m">104</span>.50<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage1_rssi**
<span class="m">116</span>.75<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="tx-received-strength-signal-indicator-tx-rssi">TX Received Strength Signal Indicator (TX RSSI)</h3>
<p>Recognizing that in TDD systems the receiver and transmitter are not operating simultaneously, the AD9361 provides the ability to reuse the receiver circuitry by multiplexing the power detector into the receive path. The receiver RSSI circuitry is then turned on during the transmit burst and results in accurate Tx RSSI measurements.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: tip="" round="" box="" 60%="" -->
<p><strong>NOTE:</strong>
This feature is only available in TX MONITOR MODE
set <strong>in_voltage0_rf_port_select</strong> to one of the following modes:
<strong>TX_MONITOR</strong>1, <strong>TX_MONITOR2</strong> or <strong>TX_MONITOR1_2</strong></p>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage0_rssi**
<span class="m">30</span>.50<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage1_rssi**
<span class="m">0</span>.00<span class="w"> </span>dB
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="calibration-mode-controls">Calibration Mode Controls</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>calib_mode_available**
auto<span class="w"> </span>manual<span class="w"> </span>manual_tx_quad<span class="w"> </span>tx_quad<span class="w"> </span>rf_dc_offs<span class="w"> </span>rssi_gain_step
</pre></div>
</div>
<div class="docutils">
<table>
<thead>
<tr class="header">
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>auto</td>
<td>Run TX Quadrature Calibration when moving to a new carrier frequency that is more than 100 MHz away from the previous carrier frequency</td>
</tr>
<tr class="even">
<td>manual</td>
<td>Disables auto mode</td>
</tr>
<tr class="odd">
<td>manual_tx_quad</td>
<td>Disables auto mode and also prevents any TX Quad Calibration unless manually invoked using tx_quad</td>
</tr>
<tr class="even">
<td>rf_dc_offs</td>
<td>Issue RF DC Offset Calibration</td>
</tr>
<tr class="odd">
<td>tx_quad</td>
<td>Issue TX Quadrature Calibration (may have a second optional parameter (cal phase value 0..31)</td>
</tr>
<tr class="even">
<td>rssi_gain_step</td>
<td>Runs the RSSI gain step calibration. Before running this calibration, provide a single tone within the channel bandwidth and monitor the received data. Adjust the tone amplitude until the received data is within a few dB of full scale but not overloading. Once this calibration is done, <strong>calib_mode</strong> will be automatically set to its previous value.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>calib_mode**
auto
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span>tx_quad<span class="w"> </span>&gt;<span class="w"> </span>calib_mode<span class="w"> </span>**
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="with-optional-calibration-phase-offset-value">With optional calibration phase offset value</h4>
<p><a class="reference external" href="https://ez.analog.com/docs/DOC-3143">Please see the FAQ for more information</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span>tx_quad<span class="w"> </span><span class="m">14</span><span class="w"> </span>&gt;<span class="w"> </span>calib_mode<span class="w"> </span>**
</pre></div>
</div>
<div class="docutils">
<h5 class="rubric" id="force-tx-quad-phase-search">Force tx quad phase search</h5>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span>tx_quad<span class="w"> </span>-2<span class="w"> </span>&gt;<span class="w"> </span>calib_mode<span class="w"> </span>**
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="calibration-tracking-controls">Calibration Tracking Controls</h4>
<p>Writing 0, N or 1, Y to the below attributes either disables or enables the corresponding tracking option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_quadrature_tracking_en**
<span class="m">1</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>in_voltage_quadrature_tracking_en**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_quadrature_tracking_en**
<span class="m">0</span>
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_bb_dc_offset_tracking_en**
<span class="m">1</span>
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_rf_dc_offset_tracking_en**
<span class="m">1</span>
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="rf-port-selection">RF Port Selection</h3>
<p>Each receive channel has 3 differential or 6 single ended inputs that can be multiplexed to the signal chain, likewise each transmitter has 2 differential outputs that can be chosen from.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: important="" -->
<p>This setting effects all ports simultaneously. For example, there is no ability to enable R1A and R2B ports, so there are no individual controls. Everything must use the name port, therefore the nomenclature of RxA (meaning it changes both channel 1 and channel 2, to the “A” port).</p>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: tip="" round="" box="" -->
<p><strong>NOTE: Switching the RF INPUT port:</strong>
Switching the RF input port:</p>
<p>During device driver initialization the driver runs the RF DC offset calibration only on the default RF input port specified with <a class="reference internal" href="#/resources/tools-software/linux-drivers/iio-transceiver/ad9361-customization#rf_port_input_select"><span class="xref myst">these attributes</span></a>.
So if using the RF RX B or C inputs along with the RF RX A input, you should run the calibration also, once with other input band/port selected.
After calibrating each band, switching between from the A input to the B or C input should not require another calibration unless a large frequency change is made. Since the B and C inputs use the same calibration results, switching from input B to input C may require running the RF DC offset calibration.
See here: <a class="reference internal" href="#/resources/tools-software/linux-drivers/iio-transceiver/ad9361#calibration_mode_controls"><span class="xref myst">Calibration Mode Controls: rf_dc_offs</span></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: tip="" round="" box="" -->
<p><strong>NOTE: Switching the RF OUTPUT port:</strong>
During device driver initialization the driver runs the TX Quadrature calibration only on the default RF output port specified with <a class="reference internal" href="#/resources/tools-software/linux-drivers/iio-transceiver/ad9361-customization#rf_port_output_select"><span class="xref myst">these attributes</span></a>.
During regular operation TX Quadrature is only run on the select RF output.
However the TX quadrature calibration stores a separate set of calibration results for the RF TX_A and TX_B output path.
So if switching the output, the calibration must be once manually triggered.
See here: <a class="reference internal" href="#/resources/tools-software/linux-drivers/iio-transceiver/ad9361#calibration_mode_controls"><span class="xref myst">Calibration Mode Controls: tx_quad</span></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>out_voltage_rf_port_select_available**
A<span class="w"> </span>B
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_voltage_rf_port_select_available**
A_BALANCED<span class="w"> </span>B_BALANCED<span class="w"> </span>C_BALANCED<span class="w"> </span>A_N<span class="w"> </span>A_P<span class="w"> </span>B_N<span class="w"> </span>B_P<span class="w"> </span>C_N<span class="w"> </span>C_P<span class="w"> </span>TX_MONITOR1<span class="w"> </span>TX_MONITOR2<span class="w"> </span>TX_MONITOR1_2
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span>B_BALANCED<span class="w"> </span>&gt;<span class="w"> </span>in_voltage0_rf_port_select**
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="dcxo-tuning-digital-controlled-crystal-oscillator">DCXO Tuning (digital controlled crystal oscillator)</h3>
<p>The AD9361 can either be clocked from an external clock source or a local <a class="reference external" href="https://en.wikipedia.org/wiki/Crystal_oscillator">crystal oscillator</a> (XO). Since it’s likely that a Crystal oscillator is not perfect - a digital correction (DCXO) can be used to tune the external component. This only works with AT cut fundamental mode crystal resonators with a load capacitance of less than 10pF which are connected between the XTALP and XTALN pins of the AD9361.</p>
<p>This is what ADI’s <a class="reference internal" href="#/resources/eval/user-guides/ad-fmcomms2-ebz"><span class="xref myst">FMCOMMS2</span></a>, <a class="reference internal" href="#/resources/eval/user-guides/ad-fmcomms3-ebz"><span class="xref myst">FMCOMMS3</span></a>, and <a class="reference internal" href="#/resources/eval/user-guides/ad-fmcomms4-ebz"><span class="xref myst">FMCOMMS4</span></a> boards are using.</p>
<img alt="../../../_images/dcxo.png" src="../../../_images/dcxo.png" />
<p>By adjusting a capacitor within the AD9361, the resulting DCXO frequency can be adjusted to compensate for XO frequency tolerance and stability. <code class="docutils literal notranslate"><span class="pre">dcxo_tune_coarse</span></code> sets a coarse capacitor value while <code class="docutils literal notranslate"><span class="pre">dcxo_tune_fine</span></code> sets a fine capacitor value. Together, these two settings control the frequency of the DCXO. The resolution of the DCXO varies with coarse word with a worst case resolution (at coarse word = 0) of 0.0125 ppm. Using both coarse and fine words, the DCXO can vary the frequency over a ±60 ppm range.</p>
<p>After initialization (after the BBPLL and RFPLLs are programmed, calibrated, and locked), the DCXO words may be written at any time without disturbing the system.</p>
<p>The plot shows the variation of DCXO frequency over all possible variations of coarse and fine word. The XO nominal frequency used in this test was 40MHz.</p>
<p>The DCXO can be tuned using the coarse and fine tune attributes detailed below.</p>
<note tip>
This feature does not exist on the AD9363
</note>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>dcxo_tune_coarse**
<span class="m">8</span>
</pre></div>
</div>
<div class="docutils">
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>dcxo_tune_fine**
<span class="m">5920</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">5930</span><span class="w"> </span>&gt;<span class="w"> </span>dcxo_tune_fine**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>dcxo_tune_fine**
<span class="m">5930</span>
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="xo-correction">XO Correction</h3>
<p>For systems that are using single ended crystal oscillators, or an external clock source and driving it into the
XTALN pin, some correction may be necessary. What happens in this case, is you digitally correct for the oscillator offset, by determining what the actual oscillator is, and then telling the system, so it can use that specific number in it’s math for the PLL and sample rate calculations.</p>
<p>This is what the <a class="reference external" href="https://analog.com/adrv9364">FMCOMMS5</a>,
<a class="reference internal" href="#adi%3Eadrv9361"><span class="xref myst">ADI RF SOM2</span></a> and the <a class="reference internal" href="#/university/tools/pluto"><span class="xref myst">PlutoSDR</span></a> use.</p>
<p>Since every time this is written, it will re-calculate and re-program all the PLL settings (Tx LO, Rx LO, ADC and DAC sample rates), this should only be updated when disturbing the system is acceptable. (normally reprogramming the LO, or sample rates)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>xo_correction**
<span class="m">40000000</span>
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">40000005</span><span class="w"> </span>&gt;<span class="w"> </span>xo_correction**
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>xo_correction**
<span class="m">40000005</span>
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="die-temperature-reading">Die Temperature Reading</h3>
<p>For accurate results this read back requires a one-point factory calibration.
Determine the offset between this readback in millidegree Celsius and the known device temperature.
Then adjust the device tree property “adi,temp-sense-offset-signed” with a proper offset in degrees Celsius.
In the OSC advanced plugin see AUX ADC/DAC/IO tab under Temp sensor offset.
Also the absolute offset (signed char) is directly written into register 0x0B.</p>
<p>Example:</p>
<ol class="arabic simple">
<li><p>Temp Sensor Offset (Reg 0x0B) = 0xCE = -50</p></li>
<li><p>in_temp0_input readback = 28123 m°C -&gt; temperature is 28 °C</p></li>
<li><p>Actual device temperature 24 °C</p></li>
<li><p>OFFSETdelta = 24 - 28 = -4</p></li>
<li><p>Temp Sensor Offset (corrected) = -50 - 4 = -54 = 0xCA</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>in_temp0_input**
<span class="m">29825</span>
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="auxadc-reading">AuxADC Reading</h3>
<p>There is an Auxiliary ADC on the chip - that can be read like any other IIO ADC.</p>
<p>Attributes are:</p>
<ul class="simple">
<li><p>in_voltage2_offset</p></li>
<li><p>in_voltage2_raw</p></li>
<li><p>in_voltage2_scale</p></li>
</ul>
<p>To obtain the reading in mV calculate: <em>(in_voltage2_raw + in_voltage2_offset) * in_voltage2_scale</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**grep<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>in_voltage2_***
in_voltage2_offset:57
in_voltage2_raw:1494
in_voltage2_scale:0.305250
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="auxdac-writing">AuxDAC Writing</h3>
<p>There are 2 Auxiliary DACs on the chip.</p>
<p>Attributes are:</p>
<ul class="simple">
<li><p>out_voltage2_raw</p></li>
<li><p>out_voltage2_scale</p></li>
<li><p>out_voltage3_raw</p></li>
<li><p>out_voltage3_scale</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**grep<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>out_voltage2*<span class="w"> </span>out_voltage3***
out_voltage2_raw:306
out_voltage2_scale:1.000000
out_voltage3_raw:306
out_voltage3_scale:1.000000
root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**echo<span class="w"> </span><span class="m">1000</span><span class="w"> </span>&gt;<span class="w"> </span>out_voltage2_raw**
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="rssi-gain-step-calibration">RSSI Gain Step Calibration</h3>
<p>The RSSI gain step calibration can be run by setting <strong>calib_mode</strong> to <strong>rssi_gain_step</strong> (See: <a class="reference internal" href="#/resources/tools-software/linux-drivers/iio-transceiver/ad9361#calibration_mode_controls"><span class="xref myst">ad9361#calibration_mode_controls</span></a>).</p>
<p>Once the calibration is done, the error tables can be read and loaded again anytime using the dedicated sysfs attribute. Since the gain step calibration register values are dependent on the LO frequency, specifying them is also possible (gain_step_calib_reg_val = Maximum LNA Gain LNA, Gain difference word for Index 0, LNA Gain difference word for Index 1, LNA Gain difference word for Index 2, LNA Gain difference word for Index 3).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:/sys/bus/iio/devices/iio:device1&gt;<span class="w"> </span>**cat<span class="w"> </span>rssi_gain_step_error**
lna_error:<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">0</span>
mixer_error:<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">0</span>
gain_step_calib_reg_val:<span class="w"> </span><span class="m">192</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
<div class="docutils">
<h2 class="rubric" id="advanced-debug-facilities">Advanced Debug Facilities</h2>
<p>The AD9361 driver supports a number of advanced debug controls via the kernel <a class="reference external" href="https://en.wikipedia.org/wiki/debugfs">debugfs</a>.
How these device files/controls can be used is described here.
The <a class="reference internal" href="#/resources/tools-software/linux-software/fmcomms2_advanced_plugin"><span class="xref myst">AD936X Advanced Plugin</span></a> directly controls these and adds a user friendly interface.</p>
<h3 class="rubric" id="runtime-device-driver-customization">Runtime Device Driver Customization</h3>
<p>There is a large number of <a class="reference internal" href="#/resources/tools-software/linux-drivers/iio-transceiver/ad9361-customization"><span class="xref myst">AD9361 Device Driver Customization</span></a> options available. Typically these are supplied via <a class="reference external" href="https://en.wikipedia.org/wiki/device_tree">Devicetree</a>.
However for debug and evaluation purposes these can be changed during runtime. Please note that changes will be lost if the device is unbinded or the platform is rebooted. Changes will only take affect once the <code class="docutils literal notranslate"><span class="pre">initialize</span></code> attribute is written <code class="docutils literal notranslate"><span class="pre">1</span></code>. It should also be noted that the AD9361 will take a RESET, so current settings done via the main IIO API will be lost. Accessing <a class="reference external" href="https://en.wikipedia.org/wiki/debugfs">debugfs</a> requires root privileges. Only device files prefixed with <code class="docutils literal notranslate"><span class="pre">adi,</span></code> are <a class="reference internal" href="#/resources/tools-software/linux-drivers/iio-transceiver/ad9361-customization"><span class="xref myst">AD9361 Device Driver Customization Options</span></a>.</p>
<p>In order to identify if the IIO device in question (ad9361-phy) you first need to identify the IIO device number.
Therefore read the name attribute of each IIO device</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@analog:~#<span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>/sys/bus/iio/devices/iio:device*/name
/sys/bus/iio/devices/iio:device0/name:ad7291
**/sys/bus/iio/devices/iio:device1/name:ad9361-phy**
/sys/bus/iio/devices/iio:device2/name:xadc
/sys/bus/iio/devices/iio:device3/name:adf4351-udc-rx-pmod
/sys/bus/iio/devices/iio:device4/name:adf4351-udc-tx-pmod
/sys/bus/iio/devices/iio:device5/name:cf-ad9361-dds-core-lpc
/sys/bus/iio/devices/iio:device6/name:cf-ad9361-lpc
root@analog:~#
</pre></div>
</div>
<div class="docutils">
<p>Change directory to <strong>/sys/kernel/debug</strong>/iio/ iio:deviceX.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@analog:~#<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/sys/kernel/debug/iio/iio:device1
root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**ls**
<span class="o">[</span>--snip--<span class="o">]</span>
adi,txmon-2-lo-cm
adi,txmon-dc-tracking-enable
adi,txmon-delay
adi,txmon-duration
adi,txmon-high-gain
adi,txmon-low-gain
adi,txmon-low-high-thresh
adi,txmon-one-shot-mode-enable
adi,update-tx-gain-in-alert-enable
adi,xo-disable-use-ext-refclk-enable
bist_prbs
bist_timing_analysis
bist_tone
calibration_switch_control
digital_tune
direct_reg_access
gaininfo_rx1
gaininfo_rx2
initialize
loopback
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="example-to-change-the-driver-from-fdd-into-tdd-mode-operation">Example to change the driver from FDD into TDD mode operation</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**cat<span class="w"> </span>adi,frequency-division-duplex-mode-enable**
<span class="m">1</span>

root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**cat<span class="w"> </span>/sys/bus/iio/devices/iio:device1/ensm_mode_available**
sleep<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>alert<span class="w"> </span>**fdd<span class="w"> </span>pinctrl<span class="w"> </span>pinctrl_fdd_indep**

root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**echo<span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>adi,frequency-division-duplex-mode-enable**
root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**echo<span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>initialize**

root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**cat<span class="w"> </span>/sys/bus/iio/devices/iio:device1/ensm_mode_available**
sleep<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>alert<span class="w"> </span>**rx<span class="w"> </span>tx<span class="w"> </span>pinctrl**
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="gpo-manual-control">GPO Manual Control</h3>
<p>This attribute allows controlling the GPO[0…3] via debugfs.
In order to use these pins, <code class="docutils literal notranslate"><span class="pre">adi,gpo-manual-mode-enable</span></code> must be enabled.</p>
<p><note warning>Be aware that GPO manual mode can conflict with external LNA and
automatic ENSM slave mode.</note>
GPOs can be addressed individual 0…3 or
altogether using 0xF as Identifier.</p>
<p><strong>SYNTAX:</strong></p>
<p><strong>gpo_set</strong> <em><Identifier></em> <em><Value></em></p>
<table>
<thead>
<tr class="header">
<th>Enable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Value</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>X</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cd /sys/kernel/debug/iio/iio:device1</span>
<span class="c1"># echo 1 &gt; adi,gpo-manual-mode-enable</span>
<span class="c1"># echo 0 1 &gt; gpo_set</span>
<span class="c1"># echo 0 0 &gt; gpo_set</span>
<span class="c1"># echo 0xF 0xF &gt; gpo_set</span>
<span class="c1"># echo 0xF 0 &gt; gpo_set</span>
</pre></div>
</div>
<div class="docutils">
<h3 class="rubric" id="build-in-self-test-bist">Build-In Self-Test (BIST)</h3>
<p>Controling these attribute files directly take effect and therefore don’t require the <code class="docutils literal notranslate"><span class="pre">initialize</span></code> sequence.
Test functionality exposed here is only meant to route or inject test patterns/data than can be used to validate the Digital Interface or functionality of the device.</p>
<h4 class="rubric" id="bist-tone">BIST Tone</h4>
<p>User selectable tone (with frequency and level selection), that can either injected into the RX or TX path.
A MASK can be supplied to disable certain channels.
A masked channel (box check) is not driving any data.</p>
<p>SYNTAX:</p>
<p><strong>bist_tone</strong> <em><Injection Point> <Tone Frequency> <Tone Level> <Channel Mask></em></p>
<table>
<thead>
<tr class="header">
<th>Injection Point</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Value</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>Tone Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Value</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>&gt; 3</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>Tone Level (dbFS)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Value</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
<tr class="odd">
<td>6</td>
</tr>
<tr class="even">
<td>12</td>
</tr>
<tr class="odd">
<td>18</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>Channel Mask</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bit</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: Inject -6dBFS tone at Fsample/32 into RX (all channels enabled)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**echo<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>bist_tone<span class="w"> </span>**
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="prbs">PRBS</h4>
<p>Pseudorandom Binary Sequence (<a class="reference external" href="https://en.wikipedia.org/wiki/Pseudorandom_binary_sequence">PRBS</a>) that can either injected into the RX or TX path.</p>
<p>SYNTAX:</p>
<p><strong>bist_prbs</strong> <em><Injection Point></em></p>
<table>
<thead>
<tr class="header">
<th>Injection Point</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Value</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: Inject PRBS into RX</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**echo<span class="w"> </span><span class="m">2</span><span class="w"> </span>&gt;<span class="w"> </span>bist_prbs<span class="w"> </span>**
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="bist-loopback">BIST Loopback</h4>
<p>Allows either to digitally loopback TX data into the RX path or vice versa.</p>
<ul class="simple">
<li><p>Digital TX -&gt; Digital RX loopback : The loopback happens inside the AD9361/4 close to the internal digital interface block. The entire RF section is bypassed. This can be used to validate (monitor on RX) the digital samples/symbols sent to the device.</p></li>
<li><p>RF RX -&gt; RF TX loopback : The loopback happens in the ADI provided HDL core. The Transmitter will transmit anything that the receiver receives. The entire RF chain is active (Sample rates, RF bandwidth and FIR settings will all effect the transmission.</p></li>
</ul>
<p><strong>SYNTAX:</strong></p>
<p><strong>loopback</strong> <em><Mode></em></p>
<table>
<thead>
<tr class="header">
<th>Value</th>
<th>Mode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Disable</td>
</tr>
<tr class="even">
<td>1</td>
<td>Digital TX -&gt; Digital RX</td>
</tr>
<tr class="odd">
<td>2</td>
<td>RF RX -&gt; RF TX</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: Digital TX -&gt; Digital RX</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<!-- ATTRS: box="" bggreen="" -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<!-- ATTRS: info="" -->
<p>This specifies any shell prompt running on the target</p>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@analog:/sys/kernel/debug/iio/iio:device1#<span class="w"> </span>**echo<span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>loopback<span class="w"> </span>**
</pre></div>
</div>
<div class="docutils">
<h4 class="rubric" id="bist-timing-analysis">BIST Timing Analysis</h4>
<p><strong>bist_timing_analysis</strong>:
See here: <a class="reference internal" href="#/resources/eval/user-guides/ad-fmcomms2-ebz/interface_timing_validation"><span class="xref myst">Digital Interface Timing Verification</span></a></p>
<h4 class="rubric" id="digital-tune">Digital Tune</h4>
<p><strong>digital_tune</strong>:
See here: <a class="reference internal" href="#/resources/eval/user-guides/ad-fmcomms2-ebz/interface_timing_validation"><span class="xref myst">Digital Interface Timing Verification</span></a></p>
<h2 class="rubric" id="low-level-register-access-via-debugfs-direct-reg-access">Low level register access via debugfs (direct_reg_access)</h2>
<!-- CMDS: noheader firstseconly noeditbtn -->
<h2 class="rubric" id="more-information">More Information</h2>
<!-- CMDS: noheader firstseconly noeditbtn -->
<h2 class="rubric" id="devicetree-maps">Devicetree Maps</h2>
<ul class="simple">
<li><p><a class="reference internal" href="dts_graphs/adi-fmcomms5.dtsi.html#adi-fmcomms5-dtsi"><span class="std std-ref">adi-fmcomms5.dtsi</span></a></p></li>
<li><p><a class="reference internal" href="dts_graphs/adi-fmcomms2.dtsi.html#adi-fmcomms2-dtsi"><span class="std std-ref">adi-fmcomms2.dtsi</span></a></p></li>
<li><p><a class="reference internal" href="dts_graphs/adi-fmcomms4.dtsi.html#adi-fmcomms4-dtsi"><span class="std std-ref">adi-fmcomms4.dtsi</span></a></p></li>
</ul>
</div>
</section>
</section>
</section>
</section>


          </div>
              <div class="related">
                &nbsp;
    <a href="../iio-adc/axi-adc-hdl.html" title="Previous document" class="prev">AXI ADC HDL Linux Driver</a>
    <a href="ad9371.html" title="Next document" class="next">AD9371, AD9375 highly integrated, wideband RF transceiver Linux device driver</a>
              </div>
          
        </div>
      </div>
  </div>

  <div id="vertical-border"></div>

  <label id="cancel-area-show-toc" for="input-show-toc"></label>
  <label id="cancel-area-show-localtoc" for="input-show-localtoc"></label>

  
  <form action="" method="get" class="search-area">
    <input type="text" name="q" aria-labelledby="search-documentation" value="" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="search" placeholder="Search"/>
    <button value="search"></button>
    <span id="search-progress"></span>
  </form>
  
    <footer>
      &#169;2024, Analog Devices, Inc.
      
      |
      Made with <a href="https://www.sphinx-doc.org/">Sphinx</a>
      &amp; <a href="https://github.com/analogdevicesinc/doctools">Doctools</a>
      
    </footer>
  </body>
</html>