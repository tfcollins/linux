====== ADAU1372 Sound CODEC Linux Driver ======

===== Supported Devices =====

  * [[adi>ADAU1372]]

===== Evaluation Boards =====

  * [[adi>EVAL-ADAU1372]]

====== Source Code ======

==== Status ====

^ Source ^ Mainlined? ^
| [[linux.github>asoc-adau1372?sound/soc/codecs/adau1372.c|git]] | [[git.linux.org>sound/soc/codecs/adau1372.c|WiP]] |

==== Files ====

^ Function ^ File ^
| driver  | [[linux.github>asoc-adau1372?sound/soc/codecs/adau1372.c|sound/soc/codecs/adau1372.c]] |
| driver  | [[linux.github>asoc-adau1372?sound/soc/codecs/adau1372-i2c.c|sound/soc/codecs/adau1372-i2c.c]] |
| driver  | [[linux.github>asoc-adau1372?sound/soc/codecs/adau1372-spi.c|sound/soc/codecs/adau1372-spi.c]] |
| include | [[linux.github>asoc-adau1372?sound/soc/codecs/adau1372.h|sound/soc/codecs/adau1372.h]] |

====== Example device initialization ======

{{page>software/linux/docs/platform_and_bus_model#Platform Data&noheader&firstseconly&noeditbtn}}

==== I2C ====

{{page>software/linux/docs/platform_and_bus_model#Declaring I2C devices&firstseconly&noeditbtn}}

The I2C device id depends on the ADDR0 and ADDR1 pin settings and needs to be set according to your board setup.

^ ADDR1 ^ ADDR0 ^ I2C device id ^
| 0 | 0 | 0x3c |
| 0 | 1 | 0x3d |
| 1 | 0 | 0x3e |
| 1 | 1 | 0x3f |

In this example we assume ADDR0=0 and ADDR1=0.

<code c>
static struct i2c_board_info __initdata bfin_i2c_board_info[] = {

	[--snip--]
	{
		I2C_BOARD_INFO("adau1372", 0x3c),
	},
	[--snip--]
}

</code>

<code c>
static int __init stamp_init(void)
{
	[--snip--]
	i2c_register_board_info(0, bfin_i2c_board_info,
				ARRAY_SIZE(bfin_i2c_board_info));
	[--snip--]

	return 0;
}
arch_initcall(board_init);
</code>

==== SPI ====

{{page>software/linux/docs/platform_and_bus_model#Declaring SPI slave devices&firstseconly&noeditbtn}}


===== ASoC DAPM Widgets =====

The driver registers a set of input, output and supply DAPM widgets which represent the physical input and output signals of the device. For maximum power-saving these are widgets should be used in the machine driver DAPM routing to accurately model the external connections of the device.

^ Name ^ Description ^
| AIN0 | ADC0 Single-ended Analog Input |
| AIN1 | ADC1 Single-ended Analog Input |
| AIN2 | ADC2 Single-ended Analog Input |
| AIN3 | ADC3 Single-ended Analog Input |
| DMIC0_1 | Digital Microphone Input Channel 0 and 1 |
| DMIC2_3 | Digital Microphone Input Channel 2 and 3 |
| MICBIAS0 | Bias Voltage for Electret Microphone |
| MICBIAS1 | Bias Voltage for Electret Microphone |
| HPOUTL | Left Headphone Output |
| HPOUTR | Right Headphone Output |

===== ALSA Controls =====
|< - 16em >|
^ Name ^ Description ^ Configuration ^
| ADC 0 Capture Switch | Digital mute control for the first ADC path. |
| ADC 0 Capture Volume | Digital attenuation volume control for the first ADC path. |
| ADC 0+1 Bias | ADC0 and ADC1 bias current setting. Available settings: \\ "Normal operation" \\ "Enhanced performance" \\ "Power saving" |
| ADC 0+1 High-Pass-Filter | High-Pass-Filter configuration for the first and second ADC path. Available settings: \\ "Off" \\ "1 Hz" \\ "4 Hz" \\ "8 Hz" |
| ADC 1 Capture Switch | Digital mute control for the second ADC path. |
| ADC 1 Capture Volume | Digital attenuation volume control for the second ADC path. |
| ADC 2 Capture Switch | Digital mute control for the third ADC path. |
| ADC 2 Capture Volume | Digital attenuation volume control for the third ADC path. |
| ADC 2+3 Bias | ADC2 and ADC3 bias current setting. Available settings: \\ "Normal operation" \\ "Enhanced performance" \\ "Power saving" |
| ADC 2+3 High-Pass-Filter | High-Pass-Filter configuration for the third and fourth ADC path. Available settings: \\ "Off" \\ "1 Hz" \\ "4 Hz" \\ "8 Hz" |
| ADC 3 Capture Switch | Digital mute control for the fourth ADC path. |
| ADC 3 Capture Volume | Digital attenuation volume control for the fourth ADC path. |
| AFE 0+1 Bias | Analog Front-End 0 and Analog Front-End 1 bias current setting. Available settings: \\ "Normal operation" \\ "Extreme power saving" \\ "Enhanced performance" \\ "Power saving" |
| AFE 2+3 Bias | Analog Front-End 2 and Analog Front-End 3 bias current setting. Available settings: \\ "Normal operation" \\ "Extreme power saving" \\ "Enhanced performance" \\ "Power saving" |
| DAC 0 Mux | Source select for the first DAC. Available settings: \\ "Input ASRC0" \\ "Input ASRC1" |
| DAC 0 Playback Switch | Digital mute control for the first DAC path. |
| DAC 0 Playback Volume | Digital attenuation volume control for the first DAC path. |
| DAC 0+1 Bias | DAC bias current setting. Available settings: \\ "Normal operation" \\ "Power saving" \\ "Superior performance" \\ "Enhanced performance" |
| DAC 1 Mux | Source select for the second DAC. Available settings: \\ "Input ASRC0" \\ "Input ASRC1" |
| DAC 1 Playback Switch | Digital mute control for the second DAC path. |
| DAC 1 Playback Volume | Digital attenuation volume control for the second DAC path. |
| Decimator 0+1 Capture Mux | Decimator 0 and 1 input select. Available settings: \\ "ADC" \\ "DMIC" |
| Decimator 2+3 Capture Mux | Decimator 2 and 3 input select. Available settings: \\ "ADC" \\ "DMIC" |
| Headphone Bias | Headphone output bias current setting. Available settings: \\ "Normal operation" \\ "Extreme power saving" \\ "Enhanced performance" \\ "Power saving" |
| Input ASRC Playback Mux | Input sample-rate-converter input select: Available settings: \\ "Serial Input 0+1" \\ "Serial Input 2+3" \\ "Serial Input 4+5" \\ "Serial Input 6+7" |
| Microphone Bias | Microphone input bias current setting. Available settings: \\ "Normal operation" \\ "Extreme power saving" \\ "Enhanced performance" \\ "Power saving" |
| Output ASRC0 Mux | Output sample-rate-converter 0 input select. Available settings: \\ "Decimator0" \\ "Decimator1" \\ "Decimator2" \\ "Decimator3" |
| Output ASRC1 Mux | Output sample-rate-converter 1 input select. Available settings: See Output ASRC0 Mux |
| Output ASRC2 Mux | Output sample-rate-converter 2 input select. Available settings: See Output ASRC0 Mux |
| Output ASRC3 Mux | Output sample-rate-converter 3 input select. Available settings: See Output ASRC0 Mux |
| PGA 0 Boost Capture Volume | Input PGA 0 additional 10dB gain volume. |
| PGA 0 Capture Switch | Input PGA 0 mute control. |
| PGA 0 Capture Volume | Input PGA 0 gain volume control. |
| PGA 1 Boost Capture Volume | Input PGA 1 additional 10dB gain volume. |
| PGA 1 Capture Switch | Input PGA 1 mute control. |
| PGA 1 Capture Volume | Input PGA 1 gain volume control. |
| PGA 2 Boost Capture Volume | Input PGA 2 additional 10dB gain volume. |
| PGA 2 Capture Switch | Input PGA 2 mute control. |
| PGA 2 Capture Volume | Input PGA 2 gain volume control. |
| PGA 3 Boost Capture Volume | Input PGA 3 additional 10dB gain volume. |
| PGA 3 Capture Switch | Input PGA 3 mute control. |
| PGA 3 Capture Volume | Input PGA 3 gain volume control. |
| Serial Output 0 Capture Mux | Serial output channel 0 input select. Available settings: \\ "Output ASRC0" \\ "Output ASRC1" \\ "Output ASRC2" \\ "Output ASRC3" \\ "Serial Input 0" \\ "Serial Input 1" \\ "Serial Input 2" \\ "Serial Input 3" \\ "Serial Input 4" \\ "Serial Input 5" \\ "Serial Input 6" \\ "Serial Input 7" |
| Serial Output 1 Capture Mux | Serial output channel 1 input select. Available settings: See Serial Output 0 Capture Mux |
| Serial Output 2 Capture Mux | Serial output channel 2 input select. Available settings: See Serial Output 0 Capture Mux |
| Serial Output 3 Capture Mux | Serial output channel 3 input select. Available settings: See Serial Output 0 Capture Mux |
| Serial Output 4 Capture Mux | Serial output channel 4 input select. Available settings: See Serial Output 0 Capture Mux |
| Serial Output 5 Capture Mux | Serial output channel 5 input select. Available settings: See Serial Output 0 Capture Mux |
| Serial Output 6 Capture Mux | Serial output channel 6 input select. Available settings: See Serial Output 0 Capture Mux |
| Serial Output 7 Capture Mux | Serial output channel 7 input select. Available settings: See Serial Output 0 Capture Mux |
===== DAI configuration =====

The codec driver registers one DAI: **adau1372**

This DAI has a capture and a playback interface which share the clocking and are synchronous to each other. Which means they have to run in the same configuration.

==== Supported DAI formats ====

^ Name ^ Supported by driver ^ Description ^
| SND_SOC_DAIFMT_I2S     | yes | I2S mode |
| SND_SOC_DAIFMT_RIGHT_J | no | Right Justified mode |
| SND_SOC_DAIFMT_LEFT_J  | yes | Left Justified mode  |
| SND_SOC_DAIFMT_DSP_A   | yes  | data MSB after FRM LRC |
| SND_SOC_DAIFMT_DSP_B   | yes | data MSB during FRM LRC  |
| SND_SOC_DAIFMT_AC97    | no  | AC97 mode |
| SND_SOC_DAIFMT_PDM     | no  | Pulse density modulation |
| | |
| SND_SOC_DAIFMT_NB_NF | yes  | Normal bit- and frameclock |
| SND_SOC_DAIFMT_NB_IF | yes | Normal bitclock, inverted frameclock |
| SND_SOC_DAIFMT_IB_NF | yes | Inverted frameclock, normal bitclock |
| SND_SOC_DAIFMT_IB_IF | yes | Inverted bit- and frameclock |
| | |
| SND_SOC_DAIFMT_CBM_CFM | yes | Codec bit- and frameclock master |
| SND_SOC_DAIFMT_CBS_CFM | no  | Codec bitclock slave, frameclock master |
| SND_SOC_DAIFMT_CBM_CFS | no  | Codec bitclock master, frameclock slave |
| SND_SOC_DAIFMT_CBS_CFS | yes | Codec bit- and frameclock slave |

==== DAI sysclk ====

==== Example DAI configuration ====

===== TDM configuration =====

The ADAU1372 has TDM support.

  * The number of slots can be either 2, 4 or 8.
  * The slot width can be 16 or 32.
  * The slot mask can select any combination of channels on both TX and RX

Example TDM configuration:
<code c>
	ret = snd_soc_dai_set_tdm_slot(codec_dai, 0x3, 0x3, 8, 24);
</code>

===== More information =====

{{page>resources/tools-software/linux-drivers/need_help#need help&noheader&firstseconly&noeditbtn}}